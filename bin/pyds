#! /usr/bin/env python
# *-* coding: utf8 *-*

import json
import httplib
import os
import pprint
import sys

if __name__ == '__main__':
    tag = sys.argv[1] if sys.argv[1:] else None
    iface = sys.argv[2] if sys.argv[2:] else None
    server = os.environ.get('PYDS_HOST', '127.0.0.1:7070')
    if ':' not in server:
        server += ':7070'
    h = httplib.HTTPConnection(server)
    headers = {'Content-type': 'application/json'}
    h.request('GET', '/', headers=headers)
    servers = json.loads(h.getresponse().read())
    if tag:
        if iface:
            ip = servers.get(tag, {}).get(iface)
            if ip:
                print ip
        else:
            pprint.pprint(servers.get(tag, {}))
    else:
        for tag in servers:
            print tag
