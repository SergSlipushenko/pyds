#! /usr/bin/env /usr/bin/python

import httplib
import json
import sys
import socket
import subprocess
import time

if len(sys.argv) == 1:
    print "no tag specified"
    exit(1)

tag = sys.argv[1]
server = sys.argv[2]

co = subprocess.Popen(['/sbin/ifconfig'], stdout=subprocess.PIPE)
ips = [line.strip().split(':')[1].split(' ')[0]
       for line in co.stdout.read().split('\n')
       if 'inet addr:' in line]
data = json.dumps({tag: ips})
h = httplib.HTTPConnection(server)
headers = {'Content-type': 'application/json'}
h.request('POST', '/', data, headers)
r = h.getresponse()
if r.status == 200:
    print ips
